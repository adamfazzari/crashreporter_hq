{% extends "base.html" %}

{% block content %}

    <form ng-controller="SearchController" ng-submit="submitSearch()" method="post" layout="column" style="background: white; color:black;">

        {#   Search form starts here     #}
        <div layout="column" style="padding: 0px 50px">
            <div layout-gt-sm="column" ng-repeat="c in searchform.filters">
                <div layout-gt-sm="row">

                    <md-input-container style="width: 15%">
                        <md-select  ng-model="c[0]" placeholder="Choose a field">
                            <md-option ng-repeat="s in searchfields"
                                       ng-value="s.value">

                                            {a s.field a}

                            </md-option>
                        </md-select>
                    </md-input-container>

                    <md-input-container style="width: 30%">
                        <input ng-model="c[1]"
                               ng-value="c[1]">

                        </input>
                    </md-input-container>

                    <md-input-container>
                        <md-button ng-click="removeFilter(c)"
                                   ng-hide="searchform.filters.indexOf(c)==0"
                                   class="md-raised"
                                   name="remove_filter_button">

                                        Remove Field
                        </md-button>
                    </md-input-container>

                </div>
            </div>
            <div layout-gt-sm="row" layout-align="left">

                <section layout="row" layout-sm="column" layout-align="start center" style="width:25%">
                    <md-button ng-click="submitSearch()" class="md-raised" name="search_button">
                        Search
                    </md-button>

                    <md-button ng-click="addFilter()" class="md-raised" name="add_filter_button">
                        Add Field
                    </md-button>
                </section>

                <section layout="row" layout-sm="column" layout-align="end center" style="width:25%">
                    <md-button class="md-raised" ng-show="searchform.related_to_id" ng-click="removeRelatedGroup()">
                        Similar to {a searchform.related_to_id a} X
                    </md-button>

                    <md-input-container>
                        <label>Alias</label>
                        <md-select  ng-model="searchform.alias_filter">
                            <md-option ng-repeat="s in alias_filter_options" ng-value="s.value">
                                {a s.field a}
                            </md-option>
                        </md-select>
                    </md-input-container>

                    <md-input-container>
                        <label>Release</label>
                        <md-select  ng-model="searchform.release_filter" placeholder="Release Filtering">
                            <md-option ng-repeat="s in release_filter_options" ng-value="s.value">
                                {a s.field a}
                            </md-option>
                        </md-select>
                    </md-input-container>

                    <md-progress-circular id="searchprogress" class="ng-hide" md-mode="indeterminate" ng-hide="!is_searching"></md-progress-circular>
                </section>
            </div>
        </div>
        {#   Search form ends here     #}


        <div layout="column" layout-sm="column" layout-align="center center" style="height: 100px">
            <div layout-gt-sm="row">
                <p> Page {a pagination.page a} of {a pagination.max_page a}</p>
            </div>
            <div layout-gt-sm="row">
                <md-button style="width: 10px" ng-repeat="p in pagination.pages" ng-click="submitSearch(p)">
                    {a p a}
                </md-button>
            </div>
        </div>


        <table border="1" style="width:100%;" class="reporttable sortable">
            <tr>
                    <td class="tableheader">#</td>
                    <td class="tableheader" ng-show="!searchform.related_to_id">Count</td>
                    <td class="tableheader">Application</td>
                    <td class="tableheader">Version</td>
                    <td class="tableheader">User</td>
                    <td class="tableheader">Error Type</td>
                    <td class="tableheader">Error Message</td>
                    <td class="tableheader">Date</td>
                    <td class="tableheader">Time</td>
                    <td class="tableheader"></td>
                    <td class="tableheader"></td>
            </tr>

            <tr ng-repeat="r in reports" ng-show="!is_searching">
                <td>{a r.report_number a}</td>
                <td ng-show="!searchform.related_to_id"><md-button ng-click="setRelatedGroup(r.report_number)">{a r.related_report_numbers.length a}</md-button></td>
                <td>{a r.application_name a}</td>
                <td>{a r.application_version a}</td>
                <td style="width: 10%">{a r.user a}</td>
                <td>{a r.error_type a}</td>
                <td style="width: 30%">{a r.error_message a}</td>
                <td>{a r.date a}</td>
                <td>{a r.time a}</td>
                <td>
                        <md-button href="/reports/{a r.report_number a}" class="md-raised">Open</md-button>
                </td>
                <td>
                        <md-button ng-click="deleteReport(r.report_number)" class="md-raised">Delete</md-button>
                </td>
            </tr>
        </table>

    </form>


    {% if user.group_admin and show_delete %}
        <form action={{ url_for('delete_report', delete_similar=True, report_numbers=','.join(report_numbers)) }} method="post" name="login" >
            <input type='submit' name='search', value="Delete Results">
            </input>
        </form>
    {% endif %}

{% endblock %}